<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MissionLocale — Mini-jeu pro</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --accent:#2563eb; --muted:#6b7280;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:var(--bg);color:#111;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;}
  .app{width:100%;max-width:900px;}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 20px rgba(16,24,40,.08);padding:22px;}
  header{display:flex;align-items:center;gap:14px;margin-bottom:12px;}
  header h1{font-size:20px;margin:0;}
  .intro p{margin:8px 0;color:var(--muted);}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;}
  .mutebtn{background:transparent;border:1px solid #e6e9ef;color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer;}
  .center{text-align:center;}
  .grid{display:grid;gap:12px;}
  .hidden{display:none;}
  .question{font-size:18px;margin-bottom:12px;}
  .answers{display:grid;grid-template-columns:1fr;gap:8px;}
  .answer{padding:10px;border-radius:10px;border:1px solid #e6e9ef;background:#fbfcff;cursor:pointer;}
  .answer.correct{border-color:green;background:#ecfdf5;}
  .answer.wrong{border-color:#fca5a5;background:#fff1f0;}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:var(--muted);}
  .progress{height:10px;background:#eef2ff;border-radius:10px;overflow:hidden;}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed);width:0%;}
  .score{font-weight:700;}
  .meta{font-size:13px;color:var(--muted);}
  /* responsive */
  @media(min-width:700px){ .answers{grid-template-columns:1fr 1fr;} }
</style>
</head>
<body>
<div class="app card" role="application" aria-label="Jeu Mission Locale">
  <header>
    <img src="" alt="" aria-hidden="true" style="width:52px;height:52px;border-radius:8px;background:linear-gradient(135deg,#eff6ff,#ede9fe)"/>
    <div>
      <h1>Parcours pro — Mission Locale</h1>
      <div class="meta">Jeu court : quiz + scénarios — Pas d'installation, fonctionne en navigateur</div>
    </div>
  </header>

  <main id="main">
    <section id="start" class="intro">
      <p>Bienvenue ! Choisis un parcours pour travailler des compétences professionnelles : <strong>CV</strong>, <strong>Entretien</strong>, <strong>Recherche d'emploi</strong>.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
        <button class="btn" data-mode="cv">Parcours CV</button>
        <button class="btn" data-mode="entretien">Parcours Entretien</button>
        <button class="btn" data-mode="recherche">Parcours Recherche</button>
        <button class="mutebtn" id="customize">Personnaliser questions</button>
      </div>
      <p style="margin-top:12px;color:var(--muted)">Le jeu contient quiz à choix multiple et mini-scénarios à choix. Résultats sauvegardés localement.</p>
    </section>

    <section id="game" class="hidden">
      <div id="qmeta" class="meta"></div>
      <div id="question" class="question"></div>
      <div class="answers" id="answers" role="list"></div>
      <div class="footer">
        <div class="progress" aria-hidden="true"><i id="bar"></i></div>
        <div class="score" id="score">0</div>
      </div>
    </section>

    <section id="result" class="hidden center">
      <h2 id="resultTitle">Bravo !</h2>
      <p id="resultText"></p>
      <p class="meta">Score : <span id="finalScore"></span> / <span id="maxScore"></span></p>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
        <button class="btn" id="retry">Refaire</button>
        <button class="mutebtn" id="printCert">Imprimer certificat</button>
      </div>
    </section>

    <section id="editor" class="hidden">
      <h3>Éditeur simple de questions</h3>
      <p class="meta">Ajoute ou édite des questions visibles immédiatement. Sauvegarde dans le navigateur.</p>
      <div style="display:flex;gap:8px;flex-direction:column;">
        <input id="qtext" placeholder="Texte de la question" />
        <input id="opt1" placeholder="Option 1 (réponse correcte si coché)" />
        <input id="opt2" placeholder="Option 2" />
        <input id="opt3" placeholder="Option 3 (optionnel)" />
        <div style="display:flex;gap:8px;align-items:center;">
          <label><input type="checkbox" id="correct1"> correcte</label>
          <label><input type="checkbox" id="correct2"> correcte</label>
          <label><input type="checkbox" id="correct3"> correcte</label>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn" id="addQ">Ajouter</button>
          <button class="mutebtn" id="doneEdit">Terminé</button>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
/* Données de questions par défaut (français) */
const defaultBanks = {
  cv: [
    {q:"Que doit contenir un CV moderne ?", opts:["Expériences, compétences, contact","Portrait artistique uniquement","Liste de courses"], a:0},
    {q:"Quelle durée idéale pour un CV ciblé ?", opts:["1 page","5 pages","10 pages"], a:0},
    {q:"Que mettre dans 'Compétences' ?", opts:["Hard + Soft skills","Informations médicales","Historique bancaire"], a:0}
  ],
  entretien: [
    {q:"Comment commencer une réponse en entretien ?", opts:["Présentez-vous brièvement","Racontez votre vie privée en détail","Silence total"], a:0},
    {q:"Si vous ne connaissez pas la réponse à une question technique ?", opts:["Admettre et proposer comment trouver la réponse","Inventer","Rire et changer de sujet"], a:0}
  ],
  recherche: [
    {q:"Où chercher des offres adaptées ?", opts:["Sites d'emploi + réseaux locaux","Seulement les réseaux sociaux","Aucune recherche nécessaire"], a:0},
    {q:"Que faire après une candidature ?", opts:["Relancer poliment au bout d'une semaine","Ne rien faire","Envoyer le même mail tous les jours"], a:0}
  ]
};

/* État */
let bank = [];
let mode = 'cv';
let idx = 0;
let score = 0;

/* Utilitaires DOM */
const id = s=>document.getElementById(s);
const startSec = id('start'), gameSec = id('game'), resultSec = id('result'), editorSec = id('editor');

function loadBank(selected){
  mode = selected;
  const saved = localStorage.getItem('ml_bank_'+mode);
  bank = saved ? JSON.parse(saved) : (defaultBanks[selected] || []);
}

/* UI control */
function show(el){ [startSec,gameSec,resultSec,editorSec].forEach(x=>x.classList.add('hidden')); el.classList.remove('hidden'); }
function startGame(selected){
  loadBank(selected);
  if(!bank.length){ alert("Aucune question pour ce parcours — ajoutez-en via 'Personnaliser questions'."); return; }
  idx = 0; score = 0;
  id('score').textContent = score;
  renderQuestion();
  show(gameSec);
  id('qmeta').textContent = `Parcours : ${selected.toUpperCase()} — question ${idx+1}/${bank.length}`;
  updateProgress();
}
function renderQuestion(){
  const q = bank[idx];
  id('question').textContent = q.q;
  const answers = id('answers'); answers.innerHTML = '';
  q.opts.forEach((opt,i)=>{
    const btn = document.createElement('button');
    btn.className='answer';
    btn.setAttribute('role','option');
    btn.innerText = opt;
    btn.onclick = ()=>selectAnswer(i, btn);
    answers.appendChild(btn);
  });
  id('qmeta').textContent = `Parcours : ${mode.toUpperCase()} — question ${idx+1}/${bank.length}`;
}

function selectAnswer(i, btn){
  const q = bank[idx];
  const correctIndex = q.a;
  // mark
  const nodes = [...id('answers').children];
  nodes.forEach((n,j)=> n.classList.add(j===correctIndex ? 'correct' : (j===i && j!==correctIndex ? 'wrong' : '')));
  if(i===correctIndex){ score += 1; id('score').textContent = score; }
  // lock answers
  Array.from(id('answers').children).forEach(n=>n.onclick=null);
  // next
  setTimeout(()=>{
    idx++;
    if(idx>=bank.length) finish();
    else { renderQuestion(); updateProgress(); }
  }, 800);
}

function updateProgress(){ const pct = Math.round((idx / bank.length) * 100); id('bar').style.width = pct + '%'; }

function finish(){
  show(resultSec);
  id('finalScore').textContent = score;
  id('maxScore').textContent = bank.length;
  id('resultText').textContent = score === bank.length ? "Excellent — vous maîtrisez bien ce sujet !" : "Bon travail — voyez où vous pouvez progresser.";
}

/* Editor */
id('customize').onclick = ()=>{ loadBank(mode); id('qtext').value=''; id('opt1').value=''; id('opt2').value=''; id('opt3').value=''; show(editorSec); };
id('doneEdit').onclick = ()=>{ show(startSec); };
id('addQ').onclick = ()=>{
  const q = id('qtext').value.trim();
  const o1 = id('opt1').value.trim(), o2 = id('opt2').value.trim(), o3 = id('opt3').value.trim();
  if(!q || !o1 || !o2){ alert("Question, option 1 et option 2 obligatoires."); return; }
  const opts = [o1,o2]; if(o3) opts.push(o3);
  let a = 0;
  if(id('correct2').checked) a = 1;
  if(id('correct3').checked && opts[2]) a = 2;
  const newQ = {q, opts, a};
  const savedKey = 'ml_bank_'+(mode||'cv');
  const cur = localStorage.getItem(savedKey);
  const arr = cur ? JSON.parse(cur) : (defaultBanks[mode] ? defaultBanks[mode].slice() : []);
  arr.push(newQ);
  localStorage.setItem(savedKey, JSON.stringify(arr));
  alert("Question ajoutée et sauvegardée localement.");
  id('qtext').value=''; id('opt1').value=''; id('opt2').value=''; id('opt3').value='';
  id('correct1').checked = id('correct2').checked = id('correct3').checked = false;
};

/* Start buttons */
document.querySelectorAll('button[data-mode]').forEach(b=> b.addEventListener('click', e=> startGame(e.target.dataset.mode)));
id('retry').onclick = ()=> startGame(mode);

/* Print certificate */
id('printCert').onclick = ()=>{
  const name = prompt("Nom du participant (pour le certificat) :", "Nom Prénom") || "Participant";
  const html = `
    <html><head><meta charset="utf-8"><title>Certificat</title>
    <style>body{font-family:Arial;padding:30px;color:#111} .card{border:2px solid #2563eb;padding:30px;border-radius:12px} h1{color:#2563eb}</style>
    </head><body><div class="card"><h1>Attestation de participation</h1>
    <p>${name}</p>
    <p>Parcours : <strong>${mode.toUpperCase()}</strong></p>
    <p>Score : <strong>${score}</strong> / ${bank.length}</p>
    <p>Date : ${new Date().toLocaleDateString()}</p>
    <p style="margin-top:20px;font-size:13px;color:#666">Mission Locale — Exercice format court</p>
    </div></body></html>`;
  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  w.focus();
  w.print();
};

/* Accessibility: keyboard navigation for answers */
document.addEventListener('keydown', (e)=>{
  if(gameSec.classList.contains('hidden')) return;
  const answers = Array.from(id('answers').children);
  if(!answers.length) return;
  const focused = document.activeElement;
  let i = answers.indexOf(focused);
  if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){ i = (i+1) % answers.length; answers[i].focus(); }
  if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){ i = (i-1+answers.length) % answers.length; answers[i].focus(); }
  if(e.key === 'Enter' && answers.includes(focused)){ focused.click(); }
});

/* On load: show start */
show(startSec);

/* Optional: preload banks into localStorage first-run */
if(!localStorage.getItem('ml_init')){
  Object.keys(defaultBanks).forEach(k=>{
    localStorage.setItem('ml_bank_'+k, JSON.stringify(defaultBanks[k]));
  });
  localStorage.setItem('ml_init','1');
}
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLE Runner</title>

<style>
body{
  margin:0;
  background:#0d47a1;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
#container{position:relative;}
canvas{
  width:800px;
  height:450px;
  background:linear-gradient(#ffffff,#e3f2fd);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.95);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  color:#0d47a1;
  border-radius:14px;
  z-index:5;
}
button{
  margin-top:15px;
  padding:12px 24px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}
button:hover{background:#ffc107;}
.qcm button{width:100%;margin:6px 0;}
#footer{
  margin-top:12px;
  color:white;
  font-size:14px;
  font-weight:bold;
}
@media (max-width:900px){
  canvas{width:95vw;height:auto;}
}
#rotateMsg{
  position:fixed;
  inset:0;
  background:#0d47a1;
  color:white;
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:30px;
  z-index:20;
  font-size:18px;
}
</style>
</head>

<body>

<div id="rotateMsg">
ðŸ“±ðŸ”„<br><br>
Jeu en <b>mode paysage uniquement</b><br>
Tourne ton tÃ©lÃ©phone ðŸ™‚
</div>

<div id="container">
<canvas id="game" width="800" height="450"></canvas>

<div id="start" class="overlay">
<h2>Runner Mission Locale</h2>
<p>Sauter pour Ã©viter les obstacles</p>
<button id="startBtn">DÃ©marrer</button>
</div>

<div id="question" class="overlay" style="display:none"></div>
</div>

<div id="footer">
La Mission Locale vous souhaite un super jeu !
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const rotateMsg=document.getElementById("rotateMsg");

let state="menu", pausedByOrientation=false;
let score=0, level=1, speed=3, immunity=0;
const groundY=340;
const player={x:120,y:groundY,r:22,vy:0};

let obstacles=[];
let lastObstacleX=0;

/* ================= BACKGROUND WORDS ================= */
const words=[
  "CV","ENTRETIEN","COMPÃ‰TENCES","STAGE","ALTERNANCE",
  "FORMATION","PROJET","MOTIVATION","EMPLOI","AVENIR"
];
let bgWords=[];

function spawnWords(){
  const used=[];
  const count=5; // plus de mots
  for(let i=0;i<count;i++){
    let w;
    do{
      w=words[Math.floor(Math.random()*words.length)];
    }while(used.includes(w));
    used.push(w);

    bgWords.push({
      x:canvas.width+80+i*140,
      y:60+Math.random()*260,
      txt:w
    });
  }
}

/* ================= START ================= */
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("start").style.display="none";
  resetGame();
  state="play";
};

function resetGame(){
  score=0; level=1; speed=3; immunity=120;
  obstacles=[]; bgWords=[];
  lastObstacleX=0;
  player.y=groundY; player.vy=0;
}

/* ================= CONTROLS ================= */
function jump(){
  if(state==="play" && !pausedByOrientation && player.y>=groundY){
    player.vy=-12;
  }
}
addEventListener("keydown",e=>{if(e.code==="Space") jump();});
canvas.addEventListener("click",jump);
canvas.addEventListener("touchstart",jump);

/* ================= OBSTACLES ================= */
function spawnObstacle(){
  const air = level>=2 && Math.random()<0.35;
  obstacles.push({
    x:canvas.width+40,
    y:air ? groundY-90 : groundY+player.r-10,
    w:26,
    h:air ? 26 : 40,
    air:air
  });
  lastObstacleX=canvas.width+40;
}

/* ================= QUESTIONS ================= */
const questions=[
{q:"Que faut-il mettre en haut dâ€™un CV ?",c:["Nom et coordonnÃ©es","Citation","Loisirs"],a:0},
{q:"Soft skill signifie ?",c:["CompÃ©tence comportementale","Logiciel","DiplÃ´me"],a:0}
];

function showQuestion(){
  state="question";
  const q=questions[Math.floor(Math.random()*questions.length)];
  const answers=q.c.map((t,i)=>({t,ok:i===q.a})).sort(()=>Math.random()-0.5);
  const box=document.getElementById("question");
  box.innerHTML=`<h3>${q.q}</h3><div class="qcm"></div>`;
  box.style.display="flex";
  answers.forEach(a=>{
    const b=document.createElement("button");
    b.textContent=a.t;
    b.onclick=()=>{
      box.style.display="none";
      if(a.ok){immunity=120;obstacles=[];state="play";}
      else{state="menu";document.getElementById("start").style.display="flex";}
    };
    box.querySelector(".qcm").appendChild(b);
  });
}

/* ================= ORIENTATION ================= */
function checkOrientation(){
  if(innerWidth<900 && innerHeight>innerWidth){
    rotateMsg.style.display="flex"; pausedByOrientation=true;
  }else{
    rotateMsg.style.display="none"; pausedByOrientation=false;
  }
}
addEventListener("resize",checkOrientation);
checkOrientation();

/* ================= LOOP ================= */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* BACKGROUND WORDS */
  if(state==="play" && bgWords.length===0) spawnWords();
  bgWords.forEach(w=>{
    w.x-=0.5;
    ctx.globalAlpha=0.25;
    ctx.font="18px Arial";
    ctx.fillStyle="#1565c0";
    ctx.fillText(w.txt,w.x,w.y);
    ctx.globalAlpha=1;
  });
  if(bgWords.length && bgWords[0].x<-160) bgWords=[];

  if(state==="play" && !pausedByOrientation){
    player.vy+=0.6; player.y+=player.vy;
    if(player.y>groundY){player.y=groundY;player.vy=0;}

    const minGap=190 - level*6;
    const spawnChance=0.025 + level*0.004;

    if(obstacles.length<3 && canvas.width-lastObstacleX>minGap && Math.random()<spawnChance){
      spawnObstacle();
    }

    obstacles.forEach(o=>{
      o.x-=speed;
      ctx.fillStyle=o.air?"#8e24aa":"#e53935";
      ctx.fillRect(o.x,o.y,o.w,o.h);

      const dx=Math.max(o.x,Math.min(player.x,o.x+o.w))-player.x;
      const dy=Math.max(o.y,Math.min(player.y,o.y+o.h))-player.y;
      if(immunity<=0 && dx*dx+dy*dy<player.r*player.r){
        showQuestion();
      }
    });

    obstacles=obstacles.filter(o=>o.x+o.w>0);
    score++;
    if(score%350===0){level++;speed+=0.3;}
    if(immunity>0) immunity--;
  }

  /* PLAYER */
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="#ffb300"; ctx.fill();
  ctx.strokeStyle="#1565c0"; ctx.lineWidth=4; ctx.stroke();
  ctx.fillStyle="#0d47a1";
  ctx.font="12px Arial";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText("MLE",player.x,player.y);

  /* HUD */
  ctx.textAlign="left"; ctx.font="14px Arial";
  ctx.fillText("Score : "+score,10,25);
  ctx.fillText("Niveau : "+level,10,45);
  if(immunity>0) ctx.fillText("ImmunitÃ©",10,65);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>


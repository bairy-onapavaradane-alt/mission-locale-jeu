<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mission Locale ‚Äì Jeu MLE</title>

<style>
:root{
  --primary:#0f7780;
  --accent:#d1346f;
  --bg:#f5fbfc;
  --card:#ffffff;
}
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{
  margin:0;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:12px;
}
.container{max-width:980px;width:100%}
.logo{
  position:fixed;
  top:12px;
  right:12px;
  width:160px;
}
.card{
  background:var(--card);
  border-radius:12px;
  padding:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.1);
}
canvas{
  width:100%;
  background:linear-gradient(#eaf7f8,#ffffff);
  border-radius:8px;
}

/* MENU */
#menu{
  position:fixed;
  inset:0;
  background:rgba(245,251,252,.96);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.menuBox{
  background:white;
  max-width:520px;
  padding:20px;
  border-radius:14px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
}
.menuBox h1{color:var(--primary)}
.menuBox p{color:#333;line-height:1.5}
.btn{
  margin-top:14px;
  padding:12px 18px;
  font-size:16px;
  border:none;
  border-radius:10px;
  background:var(--primary);
  color:white;
  cursor:pointer;
}

/* QUIZ */
#quiz{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:200;
  align-items:center;
  justify-content:center;
}
.quizBox{
  background:white;
  padding:18px;
  border-radius:12px;
  max-width:420px;
}
.answer{
  width:100%;
  margin:6px 0;
  padding:10px;
  border-radius:8px;
  border:1px solid #ddd;
  cursor:pointer;
}
</style>
</head>

<body>

<img class="logo" src="images/logo-mle.png" alt="Logo Mission Locale">

<!-- MENU -->
<div id="menu">
  <div class="menuBox">
    <h1>Jeu Mission Locale</h1>
    <p>
      üéØ <strong>Objectif :</strong> avance le plus loin possible en √©vitant les obstacles.<br><br>
      ‚¨ÜÔ∏è Appuie sur <strong>Espace</strong> ou touche l‚Äô√©cran pour sauter.<br>
      ‚õî Si tu touches un obstacle, une question appara√Æt.<br>
      ‚ùå Mauvaise r√©ponse = score remis √† z√©ro.<br><br>
      üí° √Ä partir du niveau 4, des obstacles apparaissent dans les airs :
      <strong>ne saute pas</strong> pour les √©viter.
    </p>
    <button id="startGame" class="btn">D√©marrer le jeu</button>
  </div>
</div>

<div class="container">
  <div class="card">
    <p><strong>Niveau :</strong> <span id="level">1</span> ‚Äî <strong>Score :</strong> <span id="score">0</span></p>
    <canvas id="game" width="900" height="260"></canvas>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz">
  <div class="quizBox">
    <h3 id="quizQuestion"></h3>
    <div id="quizAnswers"></div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let running=false, speed=4, score=0, level=1;
let obstacles=[], air=[];
let lastTime=performance.now();
let player={x:60,y:180,r:18,vy:0,jump:false};

const quizData=[
 {q:"Que faut-il apporter √† un entretien ?",a:["Un CV","Une console","Rien"],c:0},
 {q:"Arriver √† l‚Äôheure signifie ?",a:["√Ä l‚Äôavance","En retard","Quand on veut"],c:0},
 {q:"Quel comportement est professionnel ?",a:["Dire bonjour","Regarder son t√©l√©phone","Crier"],c:0},
 {q:"√Ä quoi sert un stage ?",a:["D√©couvrir un m√©tier","Se reposer","Jouer"],c:0}
];

function drawPlayer(){
 ctx.fillStyle="#0f7780";
 ctx.beginPath();
 ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
 ctx.fill();
 ctx.fillStyle="white";
 ctx.font="bold 14px Arial";
 ctx.textAlign="center";
 ctx.fillText("MLE",player.x,player.y+5);
}

function spawnObstacle(){
 obstacles.push({x:canvas.width+20,w:30,h:40});
}

function spawnAir(){
 air.push({x:canvas.width+20,y:120,w:36,h:30});
}

function collision(o){
 return o.x < player.x+player.r &&
        o.x+o.w > player.x-player.r &&
        o.y < player.y+player.r &&
        o.y+o.h > player.y-player.r;
}

function showQuiz(){
 running=false;
 const q=quizData[Math.floor(Math.random()*quizData.length)];
 document.getElementById("quizQuestion").textContent=q.q;
 const box=document.getElementById("quizAnswers");
 box.innerHTML="";
 document.getElementById("quiz").style.display="flex";
 q.a.forEach((txt,i)=>{
   const b=document.createElement("button");
   b.className="answer";
   b.textContent=txt;
   b.onclick=()=>{
     document.getElementById("quiz").style.display="none";
     if(i!==q.c) score=0;
     running=true;
     requestAnimationFrame(loop);
   };
   box.appendChild(b);
 });
}

function loop(now){
 if(!running) return;
 const delta=(now-lastTime)/1000;
 lastTime=now;

 ctx.clearRect(0,0,canvas.width,canvas.height);

 // sol
 ctx.fillStyle="#e6f7f7";
 ctx.fillRect(0,200,canvas.width,60);

 // joueur
 if(player.jump){
   player.vy+=0.9;
   player.y+=player.vy;
   if(player.y>=180){player.y=180;player.jump=false;}
 }
 drawPlayer();

 // obstacles sol
 if(Math.random()<0.02) spawnObstacle();
 obstacles.forEach(o=>{
   o.x-=speed*60*delta;
   ctx.fillStyle="#8b3eff";
   ctx.fillRect(o.x,200-o.h,o.w,o.h);
   if(collision({x:o.x,y:200-o.h,w:o.w,h:o.h})) showQuiz();
 });
 obstacles=obstacles.filter(o=>o.x>-50);

 // obstacles air
 if(level>=4 && Math.random()<0.01) spawnAir();
 air.forEach(a=>{
   a.x-=speed*60*delta;
   ctx.fillStyle="#0b5560";
   ctx.fillRect(a.x,a.y,a.w,a.h);
   if(player.jump && collision({x:a.x,y:a.y,w:a.w,h:a.h})) showQuiz();
 });
 air=air.filter(a=>a.x>-50);

 score++;
 if(score>level*800){level++;speed+=0.5;}

 document.getElementById("score").textContent=score;
 document.getElementById("level").textContent=level;

 requestAnimationFrame(loop);
}

document.addEventListener("keydown",e=>{
 if(e.code==="Space" && !player.jump){
   player.jump=true;
   player.vy=-16;
 }
});
canvas.addEventListener("click",()=>{if(!player.jump){player.jump=true;player.vy=-16;}});

document.getElementById("startGame").onclick=()=>{
 document.getElementById("menu").style.display="none";
 running=true;
 requestAnimationFrame(loop);
};
</script>

</body>
</html>

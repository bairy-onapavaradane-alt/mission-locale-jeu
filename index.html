<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Runner Mission Locale</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#0d47a1;
  font-family:Arial,Helvetica,sans-serif;
  overflow:hidden;
}

#container{
  width:100%;
  max-width:900px;
  margin:auto;
  position:relative;
}

canvas{
  width:100%;
  height:auto;
  display:block;
  background:linear-gradient(#ffffff,#e3f2fd);
  border-radius:14px;
}

.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.96);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
  z-index:10;
}

button{
  padding:12px 28px;
  margin-top:14px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}

.qcm button{
  width:100%;
  margin:6px 0;
}

#footer{
  text-align:center;
  color:white;
  margin:8px;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="container">
  <canvas id="game"></canvas>

  <div id="rotate" class="overlay">
    <h2>Veuillez retourner votre t√©l√©phone</h2>
    <p>Le jeu fonctionne uniquement en mode paysage.</p>
  </div>

  <div id="menu" class="overlay" style="display:none">
    <h2>Runner Mission Locale</h2>
    <p>
      üéÆ Saute pour √©viter les obstacles<br>
      üñ±Ô∏è Clic / Toucher / Espace<br><br>
      ‚ùì En cas de collision, r√©ponds √† une question professionnelle pour continuer
    </p>
    <button id="startBtn">D√©marrer</button>
  </div>

  <div id="question" class="overlay qcm" style="display:none"></div>
  <div id="countdown" class="overlay" style="font-size:72px;display:none"></div>
</div>

<div id="footer">La Mission Locale vous souhaite un bon jeu.</div>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== ORIENTATION & SIZE ===== */
function resize(){
  if(window.innerHeight > window.innerWidth){
    document.getElementById("rotate").style.display="flex";
    canvas.style.display="none";
    return;
  }
  document.getElementById("rotate").style.display="none";
  canvas.style.display="block";
  document.getElementById("menu").style.display="flex";

  const w = document.getElementById("container").clientWidth;
  const h = Math.min(window.innerHeight*0.7, w*0.5);
  canvas.width = w;
  canvas.height = h;
}
window.addEventListener("resize",resize);
resize();

/* ===== QUESTIONS (20 uniques) ===== */
const QUESTIONS = [/* ===== QUESTIONS ===== */
const QUESTIONS = [
{q:"Quel est l‚Äôobjectif principal de la Mission Locale ?",c:["Accompagner les jeunes vers l‚Äôemploi et l‚Äôautonomie","Fournir un emploi imm√©diat","Remplacer l‚Äô√©cole"],a:0},
{q:"Un CV efficace doit √™tre :",c:["Clair et structur√©","Tr√®s long","Original √† tout prix"],a:0},
{q:"Le savoir-√™tre correspond :",c:["Au comportement professionnel","Aux dipl√¥mes","√Ä l‚Äôexp√©rience"],a:0},
{q:"Avant un entretien, il est recommand√© :",c:["De se pr√©parer","D‚Äôimproviser","De lire le CV sur place"],a:0},
{q:"Arriver √† l‚Äôheure montre :",c:["Du s√©rieux","De la rigidit√©","De la chance"],a:0},
{q:"Un refus peut permettre :",c:["De progresser","D‚Äôabandonner","De se d√©courager"],a:0},
{q:"Travailler en √©quipe demande :",c:["Communication","Autorit√©","Comp√©tition"],a:0},
{q:"Un projet professionnel peut :",c:["√âvoluer avec le temps","√ätre fig√©","√ätre impos√©"],a:0},
{q:"Une lettre de motivation doit √™tre :",c:["Personnalis√©e","Standardis√©e","Tr√®s courte"],a:0},
{q:"Un stage sert principalement √† :",c:["D√©couvrir un m√©tier","Remplacer un salari√©","√âviter l‚Äô√©cole"],a:0},
{q:"Demander conseil montre :",c:["Une d√©marche active","Une faiblesse","Un manque"],a:0},
{q:"La ponctualit√© est :",c:["Essentielle","Optionnelle","Secondaire"],a:0},
{q:"Un CV clair permet :",c:["Une lecture rapide","De cacher des lacunes","D‚Äôimpressionner visuellement"],a:0},
{q:"Une comp√©tence peut √™tre :",c:["Technique ou comportementale","Uniquement scolaire","Inn√©e"],a:0},
{q:"La motivation se remarque par :",c:["L‚Äôattitude","Les paroles seules","Le dipl√¥me"],a:0},
{q:"Se renseigner sur une entreprise permet :",c:["De mieux r√©pondre","De perdre du temps","D‚Äô√©viter l‚Äôentretien"],a:0},
{q:"Un parcours professionnel est souvent :",c:["Progressif","Lin√©aire","Parfait"],a:0},
{q:"√ätre autonome signifie :",c:["Savoir s‚Äôorganiser","Travailler seul","Ne jamais demander"],a:0},
{q:"La Mission Locale accompagne :",c:["Les jeunes de 16 √† 25 ans","Tous les √¢ges","Uniquement les dipl√¥m√©s"],a:0},
{q:"Le respect au travail est :",c:["Indispensable","N√©gociable","Optionnel"],a:0}
];
  q:"Quel est l‚Äôobjectif principal de la Mission Locale ?",
    c:[
      "Accompagner les jeunes vers l‚Äôemploi et l‚Äôautonomie",
      "Remplacer l‚Äô√©cole",
      "Fournir un emploi imm√©diat"
    ],
    a:0
  },
  {
    q:"√Ä quoi sert un CV ?",
    c:[
      "Pr√©senter son parcours professionnel",
      "Raconter sa vie personnelle",
      "Faire une demande d‚Äôaide"
    ],
    a:0
  }
];

/* ===== M√âLANGE DES R√âPONSES ===== */
function shuffleAnswers(question){
  const answers = question.c.map((text, index) => ({
    text,
    correct: index === question.a
  }));

  for(let i = answers.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [answers[i], answers[j]] = [answers[j], answers[i]];
  }

  return answers;
}

/* ===== AFFICHAGE QUESTION ===== */
function showQuestion(){
  state = "question";
  const box = document.getElementById("question");

  const q = questionDeck.shift();
  const answers = shuffleAnswers(q);

  box.innerHTML = `<h3>${q.q}</h3>`;

  answers.forEach(ans => {
    const b = document.createElement("button");
    b.textContent = ans.text;
    b.onclick = () => {
      box.style.display = "none";
      if(ans.correct){
        resumeGame();
      } else {
        showMenu();
      }
    };
    box.appendChild(b);
  });

  box.style.display = "flex";
}

let questionDeck = [];

/* ===== GAME STATE ===== */
let state="menu", score=0, level=1, speed=3, immunity=0;
const gravity=0.45;
const player={x:140,y:0,r:22,vy:0,jumps:0};
let obstacles=[], lastSpawn=0;

/* ===== UTILS ===== */
function ground(){ return canvas.height - 50; }

/* ===== RESET ===== */
function resetGame(){
  score=0; level=1; speed=3;
  obstacles=[];
  player.y=ground(); player.vy=0; player.jumps=0;
  immunity=120;
  questionDeck=[...QUESTIONS].sort(()=>Math.random()-0.5);
}

/* ===== CONTROLS ===== */
function jump(){
  if(state==="play" && player.jumps<2){
    player.vy=-14;
    player.jumps++;
  }
}
window.addEventListener("keydown",e=>{ if(e.code==="Space") jump(); });
canvas.addEventListener("click",jump);
canvas.addEventListener("touchstart",jump);

/* ===== START ===== */
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("menu").style.display="none";
  resetGame();
  startCountdown();
};

/* ===== COUNTDOWN ===== */
function startCountdown(){
  const cd=document.getElementById("countdown");
  let t=3;
  state="countdown";
  cd.style.display="flex";
  cd.textContent=t;
  const i=setInterval(()=>{
    t--; cd.textContent=t;
    if(t===0){
      clearInterval(i);
      cd.style.display="none";
      state="play";
    }
  },1000);
}

/* ===== QUESTION ===== */
function showQuestion(){
  state="question";
  const box=document.getElementById("question");
  const q=questionDeck.shift();
  box.innerHTML="<h3>"+q.q+"</h3>";
  q.c.forEach((txt,i)=>{
    const b=document.createElement("button");
    b.textContent=txt;
    b.onclick=()=>{
      box.style.display="none";
      if(i===q.a){
        immunity=120;
        startCountdown();
      } else {
        state="menu";
        document.getElementById("menu").style.display="flex";
      }
    };
    box.appendChild(b);
  });
  box.style.display="flex";
}

/* ===== OBSTACLES ===== */
function spawnObstacle(){
  const air=Math.random()<0.3;
  obstacles.push({
    x:canvas.width+30,
    y:air?ground()-90:ground()-30,
    w:24,
    h:air?22:30
  });
}

/* ===== LOOP ===== */
function loop(time){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(state==="play"){
    player.vy+=gravity;
    player.y+=player.vy;
    if(player.y>=ground()){
      player.y=ground();
      player.vy=0;
      player.jumps=0;
    }

    if(time-lastSpawn>1400){
      spawnObstacle();
      lastSpawn=time;
    }

    obstacles.forEach(o=>{
      o.x-=speed;
      ctx.fillStyle="#e53935";
      ctx.fillRect(o.x,o.y,o.w,o.h);

      if(immunity<=0 &&
         player.x+player.r>o.x &&
         player.x-player.r<o.x+o.w &&
         player.y+player.r>o.y){
        showQuestion();
      }
    });

    obstacles=obstacles.filter(o=>o.x+o.w>0);
    score++;
    if(score%500===0){ level++; speed+=0.5; }
    if(immunity>0) immunity--;
  }

  /* PLAYER */
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="#ffb300";
  ctx.fill();
  ctx.strokeStyle="#1565c0";
  ctx.lineWidth=4;
  ctx.stroke();
  ctx.fillStyle="#1565c0";
  ctx.font="bold 12px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("MLE",player.x,player.y);

  /* HUD */
  ctx.fillStyle="#0d47a1";
  ctx.font="bold 16px Arial";
  ctx.textAlign="left";
  ctx.fillText("Score : "+score,12,22);
  ctx.fillText("Niveau : "+level,12,42);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>

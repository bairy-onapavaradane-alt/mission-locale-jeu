<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Runner Mission Locale</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#0d47a1;
  font-family:Arial,Helvetica,sans-serif;
  overflow:hidden;
}
body{
  display:flex;
  flex-direction:column;
  align-items:center;
}
#container{
  width:100%;
  max-width:900px;
  position:relative;
}
canvas{
  width:100%;
  background:linear-gradient(#fff,#e3f2fd);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.97);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  z-index:10;
  padding:20px;
  color:#0d47a1;
}
button{
  margin-top:12px;
  padding:12px 28px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}
button:hover{background:#ffc107;}
.qcm button{width:100%;}
#footer{
  margin:8px;
  color:white;
  font-weight:bold;
}
#rotate{
  position:fixed;
  inset:0;
  background:#0d47a1;
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  text-align:center;
  z-index:20;
  font-size:18px;
}
</style>
</head>

<body>

<div id="rotate">
ðŸ“±ðŸ”„<br><br>
Merci de tourner votre tÃ©lÃ©phone<br>
pour jouer en mode paysage
</div>

<div id="container">
<canvas id="game"></canvas>

<div id="menu" class="overlay">
<h2>Runner Mission Locale</h2>
<p>
Saute pour Ã©viter les obstacles.<br>
Clic / Toucher / Espace<br><br>
En cas de collision, rÃ©ponds Ã  une question<br>
pour continuer.
</p>
<button id="startBtn">DÃ©marrer</button>
</div>

<div id="question" class="overlay" style="display:none"></div>
</div>

<div id="footer">La Mission Locale vous souhaite un bon jeu !</div>

<script>
/* ===== CANVAS ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){
  const w=document.getElementById("container").clientWidth;
  const h=Math.min(window.innerHeight*0.7,w*9/16);
  canvas.width=w;
  canvas.height=h;
}
window.addEventListener("resize",resize);
resize();

/* ===== ORIENTATION ===== */
const rotate=document.getElementById("rotate");
function checkOrientation(){
  if(window.innerWidth<window.innerHeight){
    rotate.style.display="flex";
    paused=true;
  }else{
    rotate.style.display="none";
    paused=false;
  }
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* ===== QUESTIONS ===== */
const QUESTIONS=[
{q:"Ã€ quoi sert principalement un CV ?",c:["PrÃ©senter son parcours professionnel","Raconter sa vie personnelle","Remplacer une lettre de motivation"],a:0},
{q:"Pourquoi prÃ©parer un entretien ?",c:["Pour structurer ses rÃ©ponses","Pour apprendre par cÅ“ur","Pour impressionner uniquement"],a:0},
{q:"Que valoriser en prioritÃ© sur un CV ?",c:["CompÃ©tences et expÃ©riences","Opinions personnelles","Loisirs sans lien"],a:0},
{q:"Ã€ quoi sert la Mission Locale ?",c:["Accompagner les jeunes vers lâ€™emploi et lâ€™autonomie","Trouver un logement immÃ©diatement","Remplacer PÃ´le emploi"],a:0},
{q:"Une ponctualitÃ© montre :",c:["Du sÃ©rieux et du respect","De la chance","Une obligation inutile"],a:0},
{q:"Lors dâ€™un entretien, il faut :",c:["Ã‰couter et rÃ©pondre clairement","Parler sans laisser lâ€™autre","Regarder son tÃ©lÃ©phone"],a:0},
{q:"Un mail professionnel doit Ãªtre :",c:["Clair et poli","Familier","TrÃ¨s long"],a:0},
{q:"Un CV efficace est :",c:["Lisible et structurÃ©","TrÃ¨s chargÃ©","Ã‰crit en langage SMS"],a:0},
{q:"Pourquoi relire un CV ?",c:["Ã‰viter les fautes","Gagner du temps","Changer le contenu"],a:0},
{q:"Une tenue adaptÃ©e permet :",c:["De faire bonne impression","De garantir lâ€™embauche","De remplacer lâ€™expÃ©rience"],a:0},
{q:"Un projet professionnel sert Ã  :",c:["Donner une direction","Trouver un emploi direct","Ã‰viter les dÃ©marches"],a:0},
{q:"En entretien, parler de ses qualitÃ©s :",c:["Montre sa motivation","Est inutile","Est mal vu"],a:0},
{q:"Un retard non justifiÃ© donne :",c:["Une mauvaise image","Aucune consÃ©quence","Plus de temps"],a:0},
{q:"La lettre de motivation sert Ã  :",c:["Expliquer sa candidature","RÃ©pÃ©ter le CV","Remplir une page"],a:0},
{q:"Un comportement professionnel est :",c:["Respectueux et engagÃ©","DÃ©tendu excessif","Autoritaire"],a:0},
{q:"Pourquoi se renseigner sur lâ€™entreprise ?",c:["Montrer son intÃ©rÃªt","Gagner du temps","Ã‰viter les questions"],a:0},
{q:"Un stage permet :",c:["DÃ©couvrir un mÃ©tier","Ã‰viter lâ€™Ã©cole","Gagner un salaire fixe"],a:0},
{q:"Un CV doit Ãªtre mis Ã  jour :",c:["RÃ©guliÃ¨rement","Une seule fois","Uniquement sur demande"],a:0},
{q:"En entretien, le regard montre :",c:["Lâ€™attention","La gÃªne","Lâ€™ennui"],a:0},
{q:"Une attitude positive aide Ã  :",c:["CrÃ©er un Ã©change","Raccourcir lâ€™entretien","Ã‰viter les questions"],a:0}
];

/* ===== UTIL ===== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

/* ===== GAME ===== */
let state="menu";
let paused=false;
let score=0;
let level=1;
let speed=3;
let obstacles=[];
let lastSpawn=0;
let immunity=0;
let jumps=0;
let questionDeck=[];

const player={
  x:120,
  y:0,
  r:24,
  vy:0
};

const GRAVITY=0.45;
const JUMP=-15;

function groundY(){return canvas.height-60;}

function resetGame(){
  score=0;
  level=1;
  speed=3;
  obstacles=[];
  immunity=120;
  player.y=groundY();
  player.vy=0;
  jumps=0;
  questionDeck=shuffle([...QUESTIONS]);
}

document.getElementById("startBtn").onclick=()=>{
  document.getElementById("menu").style.display="none";
  resetGame();
  state="countdown";
  countdown=180;
};

let countdown=0;

function jump(){
  if(state==="play" && jumps<2){
    player.vy=JUMP;
    jumps++;
  }
}
window.addEventListener("keydown",e=>{if(e.code==="Space")jump();});
canvas.addEventListener("click",jump);
canvas.addEventListener("touchstart",jump);

function spawnObstacle(){
  const air=Math.random()<0.3;
  const h=air?30:40;
  obstacles.push({
    x:canvas.width+40,
    y:air?groundY()-90:groundY()-h,
    w:26,
    h:h
  });
}

function showQuestion(){
  state="question";
  const box=document.getElementById("question");
  const q=questionDeck.shift();
  const answers=shuffle(q.c.map((t,i)=>({t,ok:i===q.a})));
  box.innerHTML=`<h3>${q.q}</h3>`;
  answers.forEach(a=>{
    const b=document.createElement("button");
    b.textContent=a.t;
    b.onclick=()=>{
      box.style.display="none";
      if(a.ok){
        immunity=120;
        state="countdown";
        countdown=120;
      }else{
        state="menu";
        document.getElementById("menu").style.display="flex";
      }
    };
    box.appendChild(b);
  });
  box.style.display="flex";
}

/* ===== LOOP ===== */
function loop(t){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(state==="countdown"){
    ctx.fillStyle="#0d47a1";
    ctx.font="bold 64px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(Math.ceil(countdown/60),canvas.width/2,canvas.height/2);
    countdown--;
    if(countdown<=0)state="play";
  }

  if(state==="play"&&!paused){
    player.vy+=GRAVITY;
    player.y+=player.vy;
    if(player.y>=groundY()){
      player.y=groundY();
      player.vy=0;
      jumps=0;
    }

    if(t-lastSpawn>1500){
      spawnObstacle();
      lastSpawn=t;
    }

    obstacles.forEach(o=>{
      o.x-=speed;
      ctx.fillStyle=immunity>0?"#81c784":"#e53935";
      ctx.fillRect(o.x,o.y,o.w,o.h);

      if(immunity<=0 &&
        player.x+player.r>o.x &&
        player.x-player.r<o.x+o.w &&
        player.y+player.r>o.y){
        showQuestion();
      }
    });

    obstacles=obstacles.filter(o=>o.x+o.w>0);
    score++;
    if(score%600===0){level++;speed+=0.6;}
    if(immunity>0)immunity--;
  }

  /* PLAYER */
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="#ffb300";
  ctx.fill();
  ctx.strokeStyle="#1565c0";
  ctx.lineWidth=4;
  ctx.stroke();
  ctx.fillStyle="#1565c0";
  ctx.font="bold 14px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("MLE",player.x,player.y);

  /* HUD */
  ctx.fillStyle="#0d47a1";
  ctx.font="bold 16px Arial";
  ctx.textAlign="left";
  ctx.fillText("Score : "+score,12,22);
  ctx.fillText("Niveau : "+level,12,44);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>

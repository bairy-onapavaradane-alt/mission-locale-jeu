<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLE Runner</title>

<style>
body{
  margin:0;
  background:#0d47a1;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}

#container{position:relative}

canvas{
  width:800px;
  height:450px;
  background:linear-gradient(#fff,#e3f2fd);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.95);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  color:#0d47a1;
  border-radius:14px;
  z-index:5;
}

button{
  margin-top:12px;
  padding:12px 24px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}
button:hover{background:#ffc107}
.qcm button{width:100%}

#footer{margin-top:10px;color:white;font-weight:bold}

#rotateMsg{
  position:fixed;
  inset:0;
  background:#0d47a1;
  color:white;
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:30px;
  z-index:20;
}
</style>
</head>

<body>

<div id="rotateMsg">ðŸ“±ðŸ”„<br><br>Tourne ton tÃ©lÃ©phone en mode paysage</div>

<div id="container">
<canvas id="game" width="800" height="450"></canvas>

<div id="start" class="overlay">
  <h2>Runner Mission Locale</h2>
  <p>Sauter pour Ã©viter les obstacles</p>
  <button id="startBtn">DÃ©marrer</button>
</div>

<div id="question" class="overlay" style="display:none"></div>
</div>

<div id="footer">La Mission Locale vous souhaite un super jeu !</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let state='menu';
let score=0, level=1, speed=4, immunity=0;
const groundY=340;

const player={x:120,y:groundY,r:22,vy:0};
let obstacles=[];
let askedQuestions = new Set(); // ðŸ”‘ empÃªche les rÃ©pÃ©titions

const questions=[ /* TES QUESTIONS INCHANGÃ‰ES */ 
  {q:"Que faut-il absolument mettre en haut dâ€™un CV ?",a:["Nom, prÃ©nom et coordonnÃ©es","Une citation","Ses loisirs"],correct:0},
  {q:"Quelle est la durÃ©e idÃ©ale pour un CV ?",a:["Une page","Plusieurs pages","Autant que voulu"],correct:0},
  {q:"Que signifie soft skill ?",a:["Savoir-Ãªtre","Logiciel","DiplÃ´me"],correct:0},
  {q:"Que faire aprÃ¨s une candidature ?",a:["Relancer poliment","Supprimer","Harceler"],correct:0},
  {q:"Quel comportement Ã©viter en entretien ?",a:["TÃ©lÃ©phone","Ã‰couter","Questions"],correct:0},
  {q:"Pourquoi relire son CV ?",a:["Ã‰viter les fautes","Changer au hasard","Ne rien faire"],correct:0},
];

document.getElementById('startBtn').onclick=()=>{
  document.getElementById('start').style.display='none';
  resetGame();
  state='play';
};

function resetGame(){
  score=0;level=1;speed=4;
  obstacles=[];
  immunity=120;
  player.y=groundY;player.vy=0;
}

function jump(){
  if(state==='play' && player.y>=groundY){
    player.vy=-12;
  }
}
window.addEventListener('keydown',e=>e.code==='Space'&&jump());
canvas.addEventListener('click',jump);

function spawnObstacle(){
  obstacles.push({x:canvas.width+30,y:groundY+12,w:26,h:40});
}

function getQuestion(){
  let remaining = questions.filter(q=>!askedQuestions.has(q.q));
  if(!remaining.length){
    askedQuestions.clear();
    remaining=[...questions];
  }
  const q = remaining[Math.floor(Math.random()*remaining.length)];
  askedQuestions.add(q.q);
  return q;
}

function showQuestion(){
  state='question';
  const q=getQuestion();
  const box=document.getElementById('question');
  box.innerHTML=`<h3>${q.q}</h3><div class="qcm"></div>`;
  box.style.display='flex';

  q.a.forEach((txt,i)=>{
    const b=document.createElement('button');
    b.textContent=txt;
    b.onclick=()=>{
      box.style.display='none';
      if(i===q.correct){
        obstacles=[];
        immunity=120;
        state='play';
      }else{
        state='menu';
        document.getElementById('start').style.display='flex';
      }
    };
    box.querySelector('.qcm').appendChild(b);
  });
}

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(state==='play'){
    player.vy+=0.6;
    player.y+=player.vy;
    if(player.y>groundY){player.y=groundY;player.vy=0;}

    if(Math.random()<0.02) spawnObstacle();

    obstacles.forEach(o=>{
      o.x-=speed;
      ctx.fillStyle=immunity?'#81c784':'#e53935';
      ctx.fillRect(o.x,o.y,o.w,o.h);

      if(!immunity &&
         player.x+player.r>o.x &&
         player.x-player.r<o.x+o.w){
        showQuestion();
      }
    });

    obstacles=obstacles.filter(o=>o.x+o.w>0);
    score++;
    if(score%400===0){level++;speed+=0.4;}
    if(immunity>0) immunity--;
  }

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle='#ffb300';ctx.fill();

  ctx.fillStyle='#0d47a1';
  ctx.fillText("Score : "+score,10,20);
  ctx.fillText("Niveau : "+level,10,40);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>


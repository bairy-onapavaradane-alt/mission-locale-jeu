<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLE Runner</title>

<style>
body{
  margin:0;
  background:#0d47a1;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
#container{position:relative;width:100%;max-width:900px;}
canvas{
  width:100%;
  height:auto;
  aspect-ratio:16/9;
  background:linear-gradient(#ffffff,#e3f2fd);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.overlay{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.96);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  color:#0d47a1;
  border-radius:14px;
  z-index:5;
  padding:20px;
}
button{
  margin-top:14px;
  padding:12px 28px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}
button:hover{background:#ffc107;}
.qcm button{width:100%;margin:6px 0;}
#footer{margin-top:10px;color:white;font-weight:bold;}
#rotateMsg{
  position:fixed;
  inset:0;
  background:#0d47a1;
  color:white;
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:30px;
  z-index:20;
  font-size:18px;
}
</style>
</head>

<body>

<div id="rotateMsg">
ðŸ“±ðŸ”„<br><br>
Ce jeu se joue en <b>mode paysage</b><br>
Tourne ton tÃ©lÃ©phone ðŸ™‚
</div>

<div id="container">
  <canvas id="game" width="800" height="450"></canvas>

  <div id="start" class="overlay">
    <h2>Runner Mission Locale</h2>
    <p>
      ðŸŽ¯ <b>Objectif</b><br><br>
      Saute pour Ã©viter les obstacles.<br>
      Clic / toucher / <b>Espace</b>.<br><br>
      ðŸ§  En cas de collision, rÃ©pond correctement
      Ã  une question professionnelle.
    </p>
    <button id="startBtn">DÃ©marrer</button>
  </div>

  <div id="question" class="overlay" style="display:none"></div>
</div>

<div id="footer">La Mission Locale vous souhaite un super jeu !</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const rotateMsg=document.getElementById("rotateMsg");

/* ===== GAME STATE ===== */
let state="menu";
let paused=false;
let score=0, level=1;
let speed=3.5;
let spawnDelay=900;
let immunity=0;

const groundY=340;
const player={x:120,y:groundY,r:22,vy:0};
let obstacles=[];
let lastSpawn=0;

/* ===== BACKGROUND WORDS ===== */
const bgWords=["CV","EMPLOI","COMPÃ‰TENCES","FORMATION","ENTRETIEN","PROJET","EXPÃ‰RIENCE","AVENIR"];
const bgPositions=[];
bgWords.forEach((w,i)=>{
  bgPositions.push({text:w,x:80+(i%4)*180,y:90+Math.floor(i/4)*120});
});

/* ===== QUESTIONS (UNE SEULE FOIS) ===== */
const QUESTIONS=[
 {q:"Que faut-il mettre en haut dâ€™un CV ?",c:["Nom et coordonnÃ©es","Une citation","Ses loisirs"],a:0},
 {q:"DurÃ©e idÃ©ale dâ€™un CV ?",c:["Une page","Trois pages","Autant que nÃ©cessaire"],a:0},
 {q:"Soft skill signifie ?",c:["CompÃ©tence comportementale","Logiciel","DiplÃ´me"],a:0},
 {q:"AprÃ¨s une candidature ?",c:["Relancer poliment","Supprimer","Insister chaque jour"],a:0},
 {q:"Adapter un CV ?",c:["Selon lâ€™offre","Toujours le mÃªme","Changer les couleurs"],a:0},
 {q:"Lettre de motivation ?",c:["PersonnalisÃ©e","Copie du CV","Inutile"],a:0}
];

let questionDeck=[];
function initQuestions(){
  questionDeck=[...QUESTIONS].sort(()=>Math.random()-0.5);
}

/* ===== START ===== */
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("start").style.display="none";
  resetGame();
  state="play";
};

function resetGame(){
  score=0; level=1;
  speed=3.5; spawnDelay=900;
  immunity=160;
  obstacles=[];
  player.y=groundY; player.vy=0;
  lastSpawn=0;
  initQuestions();
}

/* ===== CONTROLS ===== */
function jump(){
  if(state==="play" && !paused && player.y>=groundY){
    player.vy=-12;
  }
}
window.addEventListener("keydown",e=>{if(e.code==="Space")jump();});
canvas.addEventListener("click",jump);
canvas.addEventListener("touchstart",jump);

/* ===== ORIENTATION ===== */
function checkOrientation(){
  if(window.innerWidth<900 && window.innerHeight>window.innerWidth){
    rotateMsg.style.display="flex"; paused=true;
  }else{
    rotateMsg.style.display="none"; paused=false;
  }
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* ===== OBSTACLES ===== */
function spawnObstacle(){
  const air = level>=2 && Math.random()<0.35;
  obstacles.push({
    x:canvas.width+30,
    y: air ? groundY-80-Math.random()*40 : groundY+player.r-10,
    w:26,h:40
  });
}

/* ===== QUESTION UNIQUE ===== */
function showQuestion(){
  state="question";

  if(questionDeck.length===0){
    alert("ðŸŽ‰ Bravo ! Tu as rÃ©ussi toutes les questions !");
    state="menu";
    document.getElementById("start").style.display="flex";
    return;
  }

  const q=questionDeck.shift();
  const box=document.getElementById("question");
  box.innerHTML=`<h3>${q.q}</h3><div class="qcm"></div>`;
  box.style.display="flex";

  q.c.forEach((txt,i)=>{
    const b=document.createElement("button");
    b.textContent=txt;
    b.onclick=()=>{
      box.style.display="none";
      if(i===q.a){
        immunity=160;
        obstacles=[];
        state="play";
      }else{
        state="menu";
        document.getElementById("start").style.display="flex";
      }
    };
    box.querySelector(".qcm").appendChild(b);
  });
}

/* ===== LOOP ===== */
function loop(time){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* BACKGROUND WORDS */
  ctx.fillStyle="rgba(13,71,161,0.07)";
  ctx.font="26px Arial";
  bgPositions.forEach(w=>ctx.fillText(w.text,w.x,w.y));

  if(state==="play" && !paused){
    player.vy+=0.6;
    player.y+=player.vy;
    if(player.y>groundY){player.y=groundY;player.vy=0;}

    if(time-lastSpawn>spawnDelay){
      spawnObstacle();
      lastSpawn=time;
    }

    obstacles.forEach(o=>{
      o.x-=speed;
      ctx.fillStyle=immunity>0?"#81c784":"#e53935";
      ctx.fillRect(o.x,o.y,o.w,o.h);

      const dx=Math.max(o.x,Math.min(player.x,o.x+o.w));
      const dy=Math.max(o.y,Math.min(player.y,o.y+o.h));
      if(immunity<=0 && (player.x-dx)**2+(player.y-dy)**2<player.r**2){
        showQuestion();
      }
    });

    obstacles=obstacles.filter(o=>o.x+o.w>0);

    score++;
    if(score%300===0){
      level++;
      speed+=0.4;
      spawnDelay=Math.max(420,spawnDelay-80);
    }
    if(immunity>0)immunity--;
  }

  /* PLAYER */
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle="#ffb300"; ctx.fill();
  ctx.strokeStyle="#1565c0"; ctx.lineWidth=4; ctx.stroke();
  ctx.fillStyle="#0d47a1";
  ctx.font="12px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("MLE",player.x,player.y);

  /* HUD */
  ctx.textAlign="left";
  ctx.font="14px Arial";
  ctx.fillText("Score : "+score,10,25);
  ctx.fillText("Niveau : "+level,10,45);
  if(immunity>0)ctx.fillText("ImmunitÃ©",10,65);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>

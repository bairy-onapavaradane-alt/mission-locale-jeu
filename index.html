<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Runner Mission Locale - Pro Edition</title>

<style>
  :root {
    --primary: #0d47a1;
    --accent: #ffca28;
    --danger: #e53935;
    --sky: #87CEEB;
  }

  html, body {
    margin: 0; padding: 0;
    background: var(--primary);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  #container {
    width: 100%;
    max-width: 900px;
    margin: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    border-radius: 14px;
    overflow: hidden;
  }

  canvas {
    width: 100%;
    height: auto;
    display: block;
    background: var(--sky);
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.92);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 30px;
    z-index: 10;
    backdrop-filter: blur(4px);
  }

  h2 { color: var(--primary); margin-top: 0; }

  button {
    padding: 14px 30px;
    margin-top: 15px;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 50px;
    background: var(--accent);
    color: #333;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    box-shadow: 0 4px 0 #c79100;
  }

  button:active {
    transform: translateY(3px);
    box-shadow: 0 1px 0 #c79100;
  }

  .qcm button {
    width: 100%;
    max-width: 400px;
    margin: 8px 0;
    text-align: left;
    padding: 15px 25px;
  }

  #footer {
    text-align: center;
    color: white;
    padding: 15px;
    font-size: 14px;
    opacity: 0.8;
  }

  #rotate { display: none; background: var(--primary); color: white; }
  
  @media (orientation: portrait) {
    #rotate { display: flex; }
    #game, #menu, #question { display: none !important; }
  }
</style>
</head>
<body>

<div id="container">
  <canvas id="game"></canvas>

  <div id="rotate" class="overlay">
    <h2>üì± Mode Paysage Requis</h2>
    <p>Tourne ton t√©l√©phone pour commencer l'aventure !</p>
  </div>

  <div id="menu" class="overlay">
    <h2>Mission Locale Runner</h2>
    <p><b>Objectif :</b> Parcourez la plus longue distance possible.<br>
    <b>Bonus :</b> R√©pondez correctement pour survivre aux obstacles !</p>
    <p style="font-size: 0.9em;">‚å®Ô∏è ESPACE ou üëÜ TOUCHER pour sauter (Double saut possible)</p>
    <button id="startBtn">C'EST PARTI !</button>
  </div>

  <div id="question" class="overlay qcm" style="display:none"></div>
  <div id="countdown" class="overlay" style="font-size:80px; font-weight:bold; color:var(--primary); display:none"></div>
</div>

<div id="footer">Propuls√© par la Mission Locale ‚Äî Accompagnement & Avenir</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* CONFIGURATION */
let state = "menu";
let score = 0, level = 1, speed = 4, immunity = 0;
const gravity = 0.6;
const player = { x: 100, y: 0, r: 24, vy: 0, jumps: 0, angle: 0 };
let obstacles = [];
let clouds = [];
let lastSpawn = 0;
let questionDeck = [];

const QUESTIONS = [
  {q:"Quel est l‚Äôobjectif principal de la Mission Locale ?",c:["Accompagner les jeunes vers l‚Äôemploi et l‚Äôautonomie","Fournir un emploi imm√©diat","Remplacer l‚Äô√©cole"],a:0},
  {q:"Un CV efficace doit √™tre :",c:["Clair et structur√©","Tr√®s long","Original √† tout prix"],a:0},
  {q:"Le savoir-√™tre correspond :",c:["Au comportement professionnel","Aux dipl√¥mes","√Ä l‚Äôexp√©rience"],a:0},
  {q:"Avant un entretien, il est recommand√© :",c:["De se pr√©parer","D‚Äôimproviser","De lire le CV sur place"],a:0},
  {q:"Arriver √† l‚Äôheure montre :",c:["Du s√©rieux","De la rigidit√©","De la chance"],a:0},
  {q:"Un refus peut permettre :",c:["De progresser","D‚Äôabandonner","De se d√©courager"],a:0},
  {q:"Travailler en √©quipe demande :",c:["Communication","Autorit√©","Comp√©tition"],a:0},
  {q:"La Mission Locale accompagne :",c:["Les jeunes de 16 √† 25 ans","Tous les √¢ges","Uniquement les dipl√¥m√©s"],a:0}
];

/* INITIALISATION */
function resize() {
  const container = document.getElementById("container");
  canvas.width = container.clientWidth;
  canvas.height = 350; 
  player.y = ground();
}
window.addEventListener("resize", resize);
resize();

function ground() { return canvas.height - 60; }

function resetGame() {
  score = 0; level = 1; speed = 4;
  obstacles = [];
  clouds = Array.from({length: 5}, () => ({x: Math.random()*canvas.width, y: Math.random()*100, s: Math.random()*0.5 + 0.2}));
  player.y = ground(); player.vy = 0; player.jumps = 0;
  immunity = 0;
  questionDeck = [...QUESTIONS].sort(() => Math.random() - 0.5);
}

/* INPUTS */
function handleInput(e) {
  if(e.type === "keydown" && e.code !== "Space") return;
  if(state === "play" && player.jumps < 2) {
    player.vy = -12;
    player.jumps++;
  }
}
window.addEventListener("keydown", handleInput);
canvas.addEventListener("touchstart", (e) => { e.preventDefault(); handleInput(e); }, {passive: false});

/* LOGIQUE DU JEU */
document.getElementById("startBtn").onclick = () => {
  document.getElementById("menu").style.display = "none";
  resetGame();
  startCountdown();
};

function startCountdown() {
  const cd = document.getElementById("countdown");
  let t = 3; state = "countdown";
  cd.style.display = "flex";
  cd.textContent = t;
  const i = setInterval(() => {
    t--; 
    if(t > 0) cd.textContent = t;
    else {
      clearInterval(i);
      cd.style.display = "none";
      state = "play";
    }
  }, 800);
}

function showQuestion() {
  state = "question";
  if(questionDeck.length === 0) questionDeck = [...QUESTIONS].sort(() => Math.random() - 0.5);
  
  const box = document.getElementById("question");
  const q = questionDeck.shift();
  box.innerHTML = `<h2 style="font-size:1.2em">${q.q}</h2>`;
  
  q.c.forEach((txt, i) => {
    const b = document.createElement("button");
    b.textContent = txt;
    b.onclick = () => {
      box.style.display = "none";
      if(i === q.a) {
        immunity = 100; // Frames d'invincibilit√©
        startCountdown();
      } else {
        state = "menu";
        document.getElementById("menu").

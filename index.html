<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mission Locale — Dino Pro (Infini + Quiz & Niveaux)</title>
<style>
  :root{
    --bg: #f7fcfd;
    --primary: #0f7780;
    --accent: #d1346f;
    --muted: #6b7280;
    --card: #ffffff;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter, Arial, Helvetica, sans-serif}
  html,body{height:100%}
  body{background:var(--bg);display:flex;align-items:center;justify-content:center;padding:12px}
  .container{width:100%;max-width:980px}
  .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:12px}
  .title{font-size:18px;color:var(--primary);font-weight:700}
  .meta{font-size:13px;color:var(--muted)}
  .logo{position:fixed;top:12px;right:12px;width:220px;max-width:34vw;z-index:40}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 20px rgba(16,24,40,.08);padding:12px}
  canvas{display:block;width:100%;height:auto;border-radius:8px;background:linear-gradient(180deg,#eaf7f8,#fff);touch-action:none}
  .controls{display:flex;gap:8px;align-items:center;margin-top:8px}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--primary);color:white;cursor:pointer;font-weight:700}
  .btnGhost{background:transparent;border:1px solid #e6eef0;color:var(--muted);padding:6px 10px;border-radius:8px}
  #hud{margin-left:auto;color:var(--muted);font-weight:700}
  #quizModal{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);padding:16px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.25);z-index:60;width:min(92%,420px)}
  #quizModal h3{color:var(--primary);margin-bottom:8px}
  .answerBtn{display:block;width:100%;text-align:left;margin:6px 0;padding:10px;border-radius:8px;border:1px solid #e6eef0;background:#fbfeff;cursor:pointer}
  .flash{position:fixed;left:50%;top:14%;transform:translateX(-50%);padding:8px 12px;color:white;border-radius:8px;z-index:70}
  @media (max-width:600px){
    .logo{width:140px}
    .title{font-size:16px}
    canvas{max-height:54vh}
  }
</style>
</head>
<body>
  <!-- Remplace REPLACE_LOGO par ton base64 (ou par le nom du fichier image dans le repo) -->
  <img id="logo" class="logo" alt="Logo Mission Locale" src="REPLACE_LOGO">
  <div class="container">
    <div class="card">
      <div class="header">
        <div>
          <div class="title">Parcours pro — Mini-jeu Infini</div>
          <div class="meta">Saut: Espace / Taper l'écran — Réponds si tu perds pour continuer</div>
        </div>
        <div id="status">
          <span class="meta">Niveau: <strong id="level">1</strong></span>
          <span style="margin-left:12px" class="meta">Score: <strong id="score">0</strong></span>
        </div>
      </div>

      <canvas id="gameCanvas" width="900" height="260" aria-label="Zone de jeu"></canvas>

      <div class="controls">
        <button id="startBtn" class="btn">Démarrer / Réinitialiser</button>
        <button id="pauseBtn" class="btnGhost">Pause</button>
        <button id="fullBtn" class="btnGhost">Plein écran</button>
        <div id="hud" aria-live="polite">Vitesse : normale</div>
      </div>
    </div>
  </div>

  <div id="quizModal" role="dialog" aria-modal="true" aria-hidden="true">
    <h3 id="quizQ">Question</h3>
    <div id="quizAnswers"></div>
  </div>

<script>
/* Partie 1 JS : déclaration des utilitaires et des variables globales */
(function(){
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const fullBtn = document.getElementById('fullBtn');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const hud = document.getElementById('hud');
  const quizModal = document.getElementById('quizModal');
  const quizQ = document.getElementById('quizQ');
  const quizAnswers = document.getElementById('quizAnswers');

  // état du jeu
  let running = false;
  let paused = false;
  let speed = 4;            // vitesse initiale (augmente avec les niveaux)
  let obstacles = [];      // obstacles au sol et ciel
  let airborne = [];       // obstacles aériens (formes pro)
  let score = 0;
  let level = 1;
  let tick = 0;
  let quizMode = false;
  let waitingForAnswer = false;
  let player = {
    x: 60, y: 180, w: 28, h: 48, vy: 0, jumping: false
  };

  // paramètres réglables (faciles à modifier)
  const LEVEL_THRESHOLD = 800;    // points pour monter de niveau (x level)
  const MAX_SPEED = 16;
  const AIR_OBSTACLE_START_LEVEL = 4; // les obstacles aériens n'apparaissent qu'à partir du niveau 4
  const AIR_SPAWN_CHANCE = 0.18; // probabilité d'apparition d'un obstacle aérien quand éligible
  /* ===== utilitaires ===== */
  function rand(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function flash(text, color='#0b7777', duration=1200){
    const el = document.createElement('div');
    el.className = 'flash';
    el.style.background = color;
    el.textContent = text;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), duration);
  }
  function updateHUD(){
    scoreEl.textContent = score;
    levelEl.textContent = level;
    hud.textContent = 'Vitesse : ' + Math.round(speed);
  }

  /* ===== obstacles & background ===== */
  function spawnGroundObstacle(){
    // cubes ou cubes avec pics (visuel différencié)
    const kind = Math.random() < 0.45 ? 'cube' : 'cube_pics';
    const h = kind === 'cube' ? rand(30,44) : rand(36,56);
    const w = rand(28,46);
    const x = canvas.width + 20;
    const y = 200 - h;
    obstacles.push({x,y,w,h,kind});
  }

  function spawnAirObstacle(){
    // uniquement à partir du level défini
    // trois types stylisés "pro" : mallette, CV, étoile (icônes dessinées)
    const types = ['briefcase','cv','star'];
    const t = types[rand(0,types.length-1)];
    const w = 40;
    const h = 34;
    const x = canvas.width + 20;
    // position aérienne : plus haut
    const y = rand(70,130);
    airborne.push({x,y,w,h,t});
  }

  /* ===== draw helpers ===== */
  function drawPlayer(){
    // tête
    ctx.fillStyle = '#fdebd9';
    ctx.beginPath();
    ctx.arc(player.x + player.w/2, player.y + 12, 8, 0, Math.PI*2);
    ctx.fill();
    // corps (costume)
    ctx.fillStyle = '#0b4d52';
    ctx.fillRect(player.x, player.y + 20, player.w, player.h - 20);
    // cravate (accent)
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#d1346f';
    ctx.fillRect(player.x + player.w/2 - 4, player.y + 28, 8, 16);
  }

  function drawGroundObstacle(o){
    // cube simple
    ctx.fillStyle = o.kind === 'cube' ? '#8b3eff' : '#6b2b2b';
    ctx.fillRect(o.x, o.y, o.w, o.h);
    // if pics, draw triangles on top to make it "piquant"
    if(o.kind === 'cube_pics'){
      ctx.fillStyle = '#3b0f0f';
      const spikeCount = Math.max(2, Math.floor(o.w/8));
      for(let i=0;i<spikeCount;i++){
        const sx = o.x + (i*(o.w/spikeCount));
        ctx.beginPath();
        ctx.moveTo(sx, o.y);
        ctx.lineTo(sx + (o.w/spikeCount)/2, o.y - 10);
        ctx.lineTo(sx + (o.w/spikeCount), o.y);
        ctx.closePath();
        ctx.fill();
      }
    }
  }

  function drawAirObstacle(a){
    // draw stylized professional icon shapes so they se distingue du fond:
    if(a.t === 'briefcase'){
      // mallette
      ctx.fillStyle = '#0b5560';
      ctx.fillRect(a.x, a.y, a.w, a.h);
      ctx.fillStyle = '#cdf0f0';
      ctx.fillRect(a.x + 6, a.y + 6, a.w - 12, a.h - 12);
      // handle
      ctx.fillStyle = '#0b5560';
      ctx.fillRect(a.x + a.w/2 - 10, a.y - 6, 20, 6);
    } else if(a.t === 'cv'){
      // rectangle CV with lines
      ctx.fillStyle = '#225a78';
      ctx.fillRect(a.x, a.y, a.w, a.h);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(a.x + 6, a.y + 8, a.w - 12, 6);
      ctx.fillRect(a.x + 6, a.y + 20, a.w - 20, 6);
      ctx.fillRect(a.x + 6, a.y + 32, a.w - 20, 6);
    } else if(a.t === 'star'){
      // star: quick draw
      ctx.fillStyle = '#b47b00';
      const cx = a.x + a.w/2;
      const cy = a.y + a.h/2;
      ctx.beginPath();
      for(let i=0;i<5;i++){
        const ang = (Math.PI*2/5)*i - Math.PI/2;
        const rx = Math.cos(ang) * (a.w/3) + cx;
        const ry = Math.sin(ang) * (a.h/3) + cy;
        if(i===0) ctx.moveTo(rx,ry); else ctx.lineTo(rx,ry);
        const ang2 = ang + Math.PI/5;
        const rx2 = Math.cos(ang2) * (a.w/6) + cx;
        const ry2 = Math.sin(ang2) * (a.h/6) + cy;
        ctx.lineTo(rx2,ry2);
      }
      ctx.closePath(); ctx.fill();
    }
  }

  /* ===== background aesthetic elements (no interaction) ===== */
  const bgWords = ['CV','Compétences','Entretien','Savoir-être','Mission Locale','Stage','Emploi','Projet'];
  function drawBackground(){
    // subtle background words/icons for aesthetic only
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.fillStyle = '#0b4d52';
    ctx.font = '20px Arial';
    for(let i=0;i<6;i++){
      const w = bgWords[i % bgWords.length];
      const x = (i*140 + (tick*0.3)%900) % (canvas.width+200) - 80;
      const y = 40 + (i*30)%120;
      ctx.fillText(w, x, y);
    }
    ctx.restore();
  }
  /* ===== quiz bank: questions variées (beaucoup) ===== */
  const quizBank = [
  const questions = [
  {
    instruction: "Réponds correctement pour continuer ta progression !",
    question: "Que doit-on apporter lors d’un entretien d’embauche ?",
    answers: ["Un CV", "Une console de jeux", "Rien du tout", "Un casque audio"],
    correct: 0
  },
  {
    instruction: "Lis bien la question avant de répondre.",
    question: "Arriver à l’heure signifie :",
    answers: ["Arriver quand on veut", "Arriver 10 à 15 minutes avant", "Arriver 1 heure en retard", "Prévenir après l’heure prévue"],
    correct: 1
  },
  {
    instruction: "Réponds pour gagner des points !",
    question: "À quoi sert un stage ?",
    answers: ["À découvrir un métier", "À prendre des vacances", "À jouer toute la journée", "À éviter de travailler"],
    correct: 0
  },
  {
    instruction: "Connais-tu la réponse ?",
    question: "Où peut-on trouver des offres d’emploi ?",
    answers: ["Sur des sites spécialisés", "Sous son oreiller", "Dans un jeu vidéo", "Dans une publicité de parfum"],
    correct: 0
  },
  {
    instruction: "Une erreur enlève tous les points !",
    question: "Lorsqu’on ne comprend pas une consigne, il faut :",
    answers: ["Faire semblant d’avoir compris", "Demander des explications", "S’énerver", "Partir"],
    correct: 1
  },
  {
    instruction: "Quel comportement semblera professionnel ?",
    question: "Quel comportement est professionnel ?",
    answers: ["Dire bonjour", "Crier sur les collègues", "Utiliser son téléphone toutes les 5 minutes", "Ne parler à personne"],
    correct: 0
  },
  {
    instruction: "Connais-tu le but d’un CV ?",
    question: "Un CV doit contenir :",
    answers: ["Les compétences et les expériences", "Les photos de vacances", "Les notes du collège uniquement", "Les réseaux sociaux personnels"],
    correct: 0
  },
  {
    instruction: "Voici une question simple.",
    question: "Pour se présenter à un entretien, il est préférable de :",
    answers: ["Venir habillé proprement", "Venir en pyjama", "Venir en tenue de sport sale", "Venir avec une casquette baissée"],
    correct: 0
  },
  {
    instruction: "Santé = efficacité !",
    question: "Pour être en forme au travail, il est important de :",
    answers: ["Bien dormir", "Passer la nuit à jouer", "Ne rien manger le matin", "Ne jamais se reposer"],
    correct: 0
  },
  {
    instruction: "À toi de jouer !",
    question: "Si un métier ne convient pas, il est possible de :",
    answers: ["Ne plus rien faire", "Chercher un autre métier ou une formation", "Abandonner définitivement", "Ne plus parler à personne"],
    correct: 1
  },
  {
    instruction: "Observe bien la question.",
    question: "Lors d’un entretien, il est important de :",
    answers: ["Regarder son téléphone", "Regarder la personne qui parle", "Manger un sandwich", "Rester silencieux"],
    correct: 1
  },
  {
    instruction: "Un peu de politesse !",
    question: "Dire « merci » et « s’il vous plaît » montre :",
    answers: ["De la politesse", "De la fatigue", "De l’ennui", "De la colère"],
    correct: 0
  },
  {
    instruction: "Comportement professionnel = réussite",
    question: "Que doit-on faire lorsqu’on ne peut pas venir au travail ?",
    answers: ["Ne rien dire", "Prévenir le plus tôt possible", "Prévenir le lendemain", "Envoyer un message à un ami"],
    correct: 1
  },
  {
    instruction: "Tu connais sûrement celle-là.",
    question: "Quel document raconte votre parcours professionnel ?",
    answers: ["Un coloriage", "Un CV", "Une carte de bus", "Une facture"],
    correct: 1
  },
  {
    instruction: "Travail d’équipe !",
    question: "Quand on travaille en équipe, on doit :",
    answers: ["Échanger et s’entraider", "Garder toutes les informations pour soi", "Faire faire tout le travail aux autres", "Partir sans prévenir"],
    correct: 0
  },
  {
    instruction: "Le stage sert à découvrir.",
    question: "Lors d’un stage, il est important de :",
    answers: ["Poser des questions", "Dormir pendant les pauses", "Dire « Je sais tout »", "Refuser toutes les tâches"],
    correct: 0
  },
  {
    instruction: "Image professionnelle = essentiel",
    question: "Quel comportement donne une bonne image ?",
    answers: ["Être respectueux", "Couper la parole", "Arriver en retard", "Ne pas répondre aux messages"],
    correct: 0
  },
  {
    instruction: "Méthode pour ne rien oublier.",
    question: "Pour ne pas oublier un rendez-vous, on peut :",
    answers: ["Le noter dans un agenda", "Espérer s’en rappeler", "Ne rien faire", "Compter sur quelqu’un d’autre"],
    correct: 0
  },
  {
    instruction: "Concentration = réussite",
    question: "Pour rester concentré durant la journée, il faut :",
    answers: ["Boire de l’eau", "Se priver de sommeil", "Sauter tous les repas", "Regarder des vidéos en continu"],
    correct: 0
  },
  {
    instruction: "La Mission Locale peut t'aider !",
    question: "Pour trouver une formation adaptée, on peut :",
    answers: ["Demander conseil à la Mission Locale", "Choisir au hasard", "Prendre la même formation que ses amis", "Ignorer le sujet"],
    correct: 0
  }
];


  /* ===== quiz handling ===== */
  function showQuiz(onCorrect){
    quizMode = true;
    quizModal.style.display = 'block';
    quizModal.setAttribute('aria-hidden','false');
    // pick a random question (diverse)
    const q = quizBank[Math.floor(Math.random()*quizBank.length)];
    quizQ.textContent = q.q;
    quizAnswers.innerHTML = '';
    q.a.forEach((ans,i)=>{
      const b = document.createElement('button');
      b.className = 'answerBtn';
      b.textContent = ans;
      b.addEventListener('click', ()=>{
        // if correct
        if(i === q.correct){
          score += q.points;
          flash('+' + q.points, '#137f7f');
          // small speed boost as reward
          speed = Math.min(MAX_SPEED, speed + 0.4);
          // continue the game
          quizMode = false;
          quizModal.style.display = 'none';
          if(typeof onCorrect === 'function') onCorrect(true);
        } else {
          // wrong answer -> score reset to 0
          score = 0;
          flash('Mauvaise réponse — score remis à 0', '#b92b2b', 1500);
          quizMode = false;
          quizModal.style.display = 'none';
          if(typeof onCorrect === 'function') onCorrect(false);
        }
        updateHUD();
      });
      quizAnswers.appendChild(b);
    });
  }

  /* ===== collision & main loop ===== */
  function checkCollision(o){
    return (o.x < player.x + player.w &&
            o.x + o.w > player.x &&
            o.y < player.y + player.h &&
            o.y + o.h > player.y);
  }

  function gameLoop(){
    if(!running) return;
    if(paused || quizMode) { requestAnimationFrame(gameLoop); return; }
    tick++;
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background aesthetic
    drawBackground();

    // ground
    ctx.fillStyle = '#e6f7f7';
    ctx.fillRect(0,200,canvas.width,canvas.height-200);

    // player physics & draw
    if(player.jumping){
      player.vy += 0.9;
      player.y += player.vy;
      if(player.y >= 180){ player.y = 180; player.jumping = false; player.vy = 0; }
    }
    drawPlayer();

    // spawn ground obstacles (less frequent to preserve flow)
    if(!quizMode && tick % Math.max(60, 140 - level*8) === 0){
      if(Math.random() < 0.6) spawnGroundObstacle();
    }

    // airborne spawn only after level threshold
    if(level >= AIR_OBSTACLE_START_LEVEL && !quizMode && tick % Math.max(120, 240 - level*12) === 0){
      if(Math.random() < AIR_SPAWN_CHANCE) spawnAirObstacle();
    }

    // move & draw airborne obstacles
    for(let i = airborne.length - 1; i >= 0; i--){
      const a = airborne[i];
      a.x -= speed;
      drawAirObstacle(a);
      // AIR obstacles are avoided by staying on ground (player must NOT jump)
      if(!quizMode && a.x < player.x + player.w && a.x + a.w > player.x){
        // if player is in air -> collision -> force quiz
        if(player.jumping){
          // lost: must answer to continue
          quizMode = true;
          showQuiz(function(correct){
            // if wrong -> score already reset; continue regardless
            quizMode = false;
            // if correct, continue
          });
          // remove the airborne obstacle
          airborne.splice(i,1);
          continue;
        }
      }
      if(a.x + a.w < -50) airborne.splice(i,1);
    }

    // move & draw ground obstacles
    for(let i = obstacles.length - 1; i >= 0; i--){
      const o = obstacles[i];
      o.x -= speed;
      drawGroundObstacle(o);
      if(!quizMode && !waitingForAnswer && checkCollision(o)){
        // collision on ground -> lost: must answer question to continue
        waitingForAnswer = true;
        showQuiz(function(correct){
          waitingForAnswer = false;
          // if wrong -> score already set to 0 in showQuiz
          // if correct -> continue, possibly add reward already handled
        });
        // remove obstacle that caused collision
        obstacles.splice(i,1);
        continue;
      }
      if(o.x + o.w < -50) obstacles.splice(i,1);
    }

    // increase score slowly while running
    if(!quizMode && !waitingForAnswer && tick % 6 === 0) score++;

    // level up logic
    const threshold = level * LEVEL_THRESHOLD;
    if(score >= threshold){
      level++;
      speed = Math.min(MAX_SPEED, speed + 0.9);
      score += 50; // bonus
      flash('Niveau ' + level + ' !', '#0b6f6f', 1200);
    }

    updateHUD();
    requestAnimationFrame(gameLoop);
  }

  /* ===== controls & input ===== */
  function jump(){
    if(!player.jumping && !quizMode && !waitingForAnswer){
      player.jumping = true;
      player.vy = -16;
    }
  }

  document.addEventListener('keydown', function(e){
    if(e.code === 'Space') { e.preventDefault(); jump(); }
  });
  canvas.addEventListener('touchstart', function(e){ e.preventDefault(); jump(); }, {passive:false});
  canvas.addEventListener('click', function(){ jump(); });

  startBtn.addEventListener('click', function(){
    // reset
    running = true;
    paused = false;
    obstacles = [];
    airborne = [];
    score = 0;
    level = 1;
    speed = 4;
    player.y = 180;
    player.vy = 0;
    player.jumping = false;
    tick = 0;
    quizMode = false;
    waitingForAnswer = false;
    updateHUD();
    requestAnimationFrame(gameLoop);
  });

  pauseBtn.addEventListener('click', function(){
    paused = !paused;
    pauseBtn.textContent = paused ? 'Reprendre' : 'Pause';
  });

  fullBtn.addEventListener('click', function(){
    if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
  });

  /* responsive canvas fit */
  function fitCanvas(){
    const maxW = Math.min(window.innerWidth - 40, 980);
    const displayW = maxW;
    const displayH = Math.max(220, Math.round(displayW * 260 / 900));
    canvas.style.width = displayW + 'px';
    canvas.style.height = displayH + 'px';
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();
  updateHUD();

})(); // end IIFE
</script>
</body>
</html>


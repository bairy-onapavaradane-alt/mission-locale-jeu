<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mission Locale Runner</title>
    <style>
        :root {
            --primary: #0d47a1;
            --accent: #ffca28;
            --sky: #e3f2fd;
            --ground: #2e7d32;
        }

        /* Centrage absolu sur tous les appareils */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1a1a1a; /* Fond sombre pour faire ressortir le jeu */
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
        }

        #game-container {
            position: relative;
            /* Gestion adaptative de la taille */
            width: 95vw; 
            height: 53.43vw; /* Ratio 16/9 */
            max-width: 1000px;
            max-height: 562px;
            background: var(--sky);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            border: 4px solid #fff;
            border-radius: 12px;
            overflow: hidden;
            touch-action: none;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Score Ultra-Visible */
        #hud-score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(13, 71, 161, 0.9);
            color: var(--accent);
            padding: 10px 30px;
            border-radius: 50px;
            font-family: 'Arial Black', sans-serif;
            font-size: 24px;
            border: 3px solid white;
            z-index: 50;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.96);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 100;
            text-align: center;
        }

        .btn {
            background: var(--accent);
            color: var(--primary);
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #c79100;
            transition: 0.1s;
        }

        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #c79100; }

        .qcm-btn {
            width: 90%;
            max-width: 450px;
            padding: 15px;
            margin: 8px;
            border-radius: 12px;
            border: 2px solid var(--primary);
            background: white;
            font-weight: bold;
            font-size: 16px;
            color: var(--primary);
        }

        #rotate-notice {
            display: none;
            background: var(--primary);
            color: white;
            z-index: 999;
        }

        @media (orientation: portrait) {
            #rotate-notice { display: flex; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud-score" style="display:none">SCORE : 0</div>
    <canvas id="gameCanvas"></canvas>

    <div id="menu" class="overlay">
        <h1 style="color:var(--primary); font-size: 32px; margin-bottom: 10px;">Mission Locale Runner</h1>
        <p style="font-weight: bold; color: #555;">Sautez pour r√©ussir votre mission !</p>
        <button id="startBtn" class="btn">D√âMARRER</button>
        <p id="bestScore" style="margin-top:20px; color: var(--primary);"></p>
    </div>

    <div id="questionScreen" class="overlay" style="display:none">
        <h2 id="qText" style="color:var(--primary)">Question</h2>
        <div id="qOptions" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
    </div>

    <div id="rotate-notice" class="overlay">
        <h2>üì± MODE PAYSAGE REQUIS</h2>
        <p>Merci de tourner votre appareil.</p>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const hud = document.getElementById('hud-score');
    
    let state = 'MENU';
    let score = 0;
    let highscore = localStorage.getItem('ml_highscore_new') || 0;
    let speed = 6;
    let gameFrame = 0;

    const player = {
        x: 120, y: 0, r: 28, 
        vy: 0, gravity: 0.7, 
        jumpForce: -14, jumps: 0,
        groundY: 0
    };

    let obstacles = [];

    const QUESTIONS = [
        {q:"Quelle est la mission principale de la Mission Locale ?", c:["Vendre des voitures","Accompagner les jeunes 16-25 ans","Organiser des concerts"], a:1},
        {q:"Pour un entretien, il est important d'√™tre :", c:["En retard","Ponctuel","En pyjama"], a:1},
        {q:"Le CV sert √† pr√©senter :", c:["Ses derni√®res vacances","Son parcours et ses comp√©tences","Ses films pr√©f√©r√©s"], a:1},
        {q:"Le savoir-√™tre en entreprise, c'est :", c:["Crier fort","Le comportement et l'attitude","Savoir coder en C++"], a:1}
    ];

    function init() {
        canvas.width = 800;
        canvas.height = 450;
        player.groundY = canvas.height - 80;
        player.y = player.groundY;
        document.getElementById('bestScore').textContent = `Record personnel : ${highscore}`;
    }

    function startGame() {
        state = 'PLAY';
        document.getElementById('menu').style.display = 'none';
        hud.style.display = 'block';
        score = 0;
        speed = 6;
        obstacles = [];
        player.y = player.groundY;
        player.vy = 0;
    }

    function handleJump(e) {
        if(e) e.preventDefault();
        if (state === 'PLAY' && player.jumps < 2) {
            player.vy = player.jumpForce;
            player.jumps++;
        }
    }

    document.getElementById('startBtn').onclick = (e) => { e.stopPropagation(); startGame(); };
    canvas.addEventListener('touchstart', handleJump, {passive: false});
    window.addEventListener('keydown', (e) => { if(e.code === 'Space') handleJump(); });

    function triggerGameOver() {
        state = 'QUESTION';
        const screen = document.getElementById('questionScreen');
        screen.style.display = 'flex';
        const q = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
        
        document.getElementById('qText').textContent = q.q;
        const opts = document.getElementById('qOptions');
        opts.innerHTML = '';

        q.c.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = 'qcm-btn';
            btn.textContent = choice;
            btn.onclick = () => {
                if (i === q.a) {
                    screen.style.display = 'none';
                    state = 'PLAY';
                    obstacles = [];
                    player.vy = 0;
                } else {
                    if(score > highscore) localStorage.setItem('ml_highscore_new', score);
                    location.reload();
                }
            };
            opts.appendChild(btn);
        });
    }

    function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Sol stylis√©
        ctx.fillStyle = "#2e7d32";
        ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
        ctx.fillStyle = "#388e3c";
        ctx.fillRect(0, canvas.height - 55, canvas.width, 5);

        if (state === 'PLAY') {
            gameFrame++;
            score++;
            hud.textContent = `SCORE : ${score}`;
            if (score % 800 === 0) speed += 0.8;

            player.vy += player.gravity;
            player.y += player.vy;

            if (player.y > player.groundY) {
                player.y = player.groundY;
                player.vy = 0;
                player.jumps = 0;
            }

            if (gameFrame % 110 === 0) {
                obstacles.push({ x: canvas.width, y: player.groundY + 5, w: 35, h: 45 });
            }

            obstacles.forEach(o => {
                o.x -= speed;
                ctx.fillStyle = "#d32f2f";
                ctx.beginPath();
                ctx.roundRect(o.x, o.y, o.w, o.h, 5);
                ctx.fill();

                if (player.x + 20 > o.x && player.x - 20 < o.x + o.w && player.y + 20 > o.y) {
                    triggerGameOver();
                }
            });
            obstacles = obstacles.filter(o => o.x > -50);
        }

        // --- DESSIN JOUEUR (Le Rond MLE) ---
        ctx.save();
        ctx.translate(player.x, player.y);
        
        // Bord ext√©rieur bleu
        ctx.beginPath();
        ctx.arc(0, 0, player.r, 0, Math.PI*2);
        ctx.fillStyle = "#0d47a1";
        ctx.fill();
        
        // Int√©rieur jaune
        ctx.beginPath();
        ctx.arc(0, 0, player.r - 5, 0, Math.PI*2);
        ctx.fillStyle = "#ffca28";
        ctx.fill();

        // Texte MLE au centre
        ctx.fillStyle = "#0d47a1";
        ctx.font = "bold 16px sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("MLE", 0, 1);
        
        ctx.restore();

        requestAnimationFrame(update);
    }

    init();
    update();
</script>
</body>
</html>

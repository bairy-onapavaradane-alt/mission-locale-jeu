<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Runner Mission Locale</title>
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0d47a1;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
canvas{
  background:linear-gradient(#ffffff,#e3f2fd);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
}
.overlay{
  position:absolute;
  max-width:600px;
  background:white;
  color:#0d47a1;
  padding:20px;
  border-radius:14px;
  text-align:center;
}
button{
  padding:12px 20px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffca28;
  cursor:pointer;
}
button:hover{background:#ffc107;}
.qcm button{width:100%;margin:6px 0;}
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<div id="startScreen" class="overlay">
  <h2>Jeu Mission Locale</h2>
  <p>Sauter pour éviter les obstacles.</p>
  <p>Bonne réponse = continuer / Mauvaise = score à zéro</p>
  <button id="startBtn">Démarrer</button>
</div>

<div id="questionScreen" class="overlay" style="display:none"></div>

<script>
// ================== INITIALISATION ==================
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let gameRunning = false;
let score = 0;
let level = 1;
let speed = 4;
let gravity = 0.6;
let immunity = false;
let immunityFrames = 0;

const player = {
  x: 100,
  y: 300,
  r: 22,
  vy: 0
};

let obstacles = [];

const words = ['Mission Locale','Emploi','Formation','Insertion','CV','Entretien','Compétences'];

const questions = [
  {q:'À quoi sert un CV ?',choices:['Jouer','Présenter ses compétences','Dormir'],answer:1},
  {q:'La Mission Locale accompagne surtout les ?',choices:['Jeunes','Animaux','Retraités'],answer:0},
  {q:'Un entretien sert à ?',choices:['Évaluer un candidat','Dormir','Regarder un film'],answer:0}
];

// ================== DÉMARRAGE ==================
document.getElementById('startBtn').onclick = () => {
  document.getElementById('startScreen').style.display='none';
  resetGame();
  gameRunning = true;
};

function resetGame(){
  score = 0;
  level = 1;
  speed = 4;
  obstacles = [];
  player.y = 300;
  player.vy = 0;
  immunity = true;
  immunityFrames = 240; // 4 secondes
}

// ================== OBSTACLES ==================
function spawnObstacle(){
  const air = level>=5 && Math.random()<0.4;
  obstacles.push({
    x: canvas.width+30,
    y: air ? player.y-70 : player.y+player.r-10,
    w: 26,
    h: 40
  });
}

// ================== DESSINS ==================
function drawBackground(){
  ctx.globalAlpha=0.15;
  ctx.fillStyle='#90caf9';
  ctx.font='20px Arial';
  words.forEach((w,i)=>{
    ctx.fillText(w,(i*150+score)%canvas.width,60+(i%3)*120);
  });
  ctx.globalAlpha=1;
}

function drawPlayer(){
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle='#ffb300';
  ctx.fill();
  ctx.lineWidth=4;
  ctx.strokeStyle='#1565c0';
  ctx.stroke();
  ctx.fillStyle='#0d47a1';
  ctx.font='12px Arial';
  ctx.textAlign='center';
  ctx.fillText('MLE',player.x,player.y+4);
}

// ================== QUESTIONS ==================
function showQuestion(){
  gameRunning=false;
  const q = questions[Math.floor(Math.random()*questions.length)];
  const box = document.getElementById('questionScreen');
  box.innerHTML = `<h3>${q.q}</h3><div class="qcm"></div>`;
  box.style.display='block';

  q.choices.forEach((c,i)=>{
    const b=document.createElement('button');
    b.textContent=c;
    b.onclick=()=>{
      box.style.display='none';
      if(i===q.answer){
        immunity=true;
        immunityFrames=240;
        obstacles=[];
        gameRunning=true;
      }else{
        alert('Game Over');
        resetGame();
        gameRunning=true;
      }
    };
    box.querySelector('.qcm').appendChild(b);
  });
}
